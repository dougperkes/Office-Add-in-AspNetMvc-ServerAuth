
@using Newtonsoft.Json;

@{
    ViewBag.Title = "Authorization Complete";
}

<h2>Authorization Complete</h2>

<p>Please wait until this dialog closes</p>

@section scripts {
    
    <script>
        var oauthResult = @Html.Raw(ViewBag.AuthState);
    </script>
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    @*Reference the autogenerated SignalR hub script.*@
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
            var parentId = null, popupId = null;
            var authJson;
            $(document).ready(function () {
                //get the parentId off the url parameters
                parentId = oauthResult.signalRHubId;

                //setup signalR hub
                var hub = $.connection.socketHub;

                // Create a function that the hub can call to broadcast messages
                hub.client.sendMessage = function (message) {
                    if (message === "close") {
                        window.open('', '_self', ''); window.close();
                    }
                };

                // Start the connection.
                $.connection.hub.start().done(function () {
                    //get the popupId off the hub and send to the parent
                    popupId = $.connection.hub.id;
                    hub.server.sendMessage(parentId, popupId);
                    hub.server.sendMessage(parentId, oauthResult.authStatus);
                });
            });
    </script>


    }